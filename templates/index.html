<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookCocktail Mixologist</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>BookCocktail Mixologist ğŸ¸</h1>
    <form id="cocktail-form">
        <input type="text" id="book-title-input" name="book_title" placeholder="æ›¸ç±ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›..." required>
        <button type="submit">ã‚«ã‚¯ãƒ†ãƒ«ã‚’æ³¨æ–‡</button>
    </form>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºç”¨ã®è¦ç´  -->
    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p>æœ€é«˜ã®ã‚«ã‚¯ãƒ†ãƒ«ã‚’ã‚·ã‚§ã‚¤ã‚¯ä¸­ã§ã™...</p>
    </div>

    <!-- çµæœè¡¨ç¤ºç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="result-container"></div>

    <script>
        const form = document.getElementById('cocktail-form');
        const input = document.getElementById('book-title-input');
        const loadingDiv = document.getElementById('loading');
        const resultContainer = document.getElementById('result-container');

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

            const bookTitle = input.value;
            if (!bookTitle) return;

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’é–‹å§‹
            loadingDiv.classList.remove('hidden');
            resultContainer.innerHTML = ''; // å‰å›ã®çµæœã‚’ã‚¯ãƒªã‚¢

            try {
                const response = await fetch('/generate-for-web', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ book_title: bookTitle }),
                });

                if (!response.ok) {
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.statusText}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                console.error('Fetch error:', error);
                resultContainer.innerHTML = `<p class="error-message">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</p>`;
            } finally {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’çµ‚äº†
                loadingDiv.classList.add('hidden');
            }
        });

        function displayResults(data) {
            if (data.error) {
                resultContainer.innerHTML = `<p class="error-message">${data.error}</p>`;
                return;
            }

            // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°: ã‚½ãƒ¼ã‚¹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
            const createSourceSection = (title, icon, sourceData) => {
                let content = '<p>é–¢é€£æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                if (sourceData && sourceData.url) {
                    content = `
                        <a href="${sourceData.url}" target="_blank">${sourceData.title}</a>
                        <p>â†’ è§£èª¬: ${sourceData.commentary}</p>
                    `;
                }
                return `
                    <div class="section">
                        <h3>${icon} ${title}</h3>
                        ${content}
                    </div>
                `;
            };

            const resultHTML = `
                <div class="cocktail-result">
                    <h2>ã€${data.book_title}ã€</h2>
                    <div class="section">
                        <h3>â–  ä½œå“ã®è¦ç´„</h3>
                        <p>${data.summary}</p>
                    </div>
                    <hr>
                    ${createSourceSection('ç›¸è£œçš„ãªä¸€æ¯', 'ğŸ·', data.complementary)}
                    ${createSourceSection('å¯¾ç…§çš„ãªä¸€æ¯', 'ğŸ‹', data.contrasting)}
                    ${createSourceSection('æ„å¤–ãªä¸€æ¯', 'ğŸ§‚', data.tangent)}
                    <div class="section">
                        <h3 class="final-twist">ğŸ­ æœ€å¾Œã®ä¸€ã²ã­ã‚Š</h3>
                        <p class="final-twist">ã€Œ${data.twist}ã€</p>
                    </div>
                </div>
            `;
            resultContainer.innerHTML = resultHTML;
        }
    </script>
</body>
</html>
